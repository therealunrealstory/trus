<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Legal Timeline Demo</title>

  <!-- Подключаем эталонные стили сайта -->
  <link rel="stylesheet" href="styles.css"/>

  <!-- Минимальные локальные стили только для демо (не конфликтуют с сайтом) -->
  <style>
    /* Локальный свотч-точка в легенде (как белая точка на шкале) */
    .legend-swatch.swatch-point{
      width:14px; height:14px; border-radius:9999px;
      background:#fff; border:2px solid #fff;
      display:inline-block; vertical-align:middle;
      box-shadow:0 0 0 1px rgba(0,0,0,0.15);
    }
    /* Контейнер демо, отступы по бокам, чтобы крайние точки не прилипали */
    .demo-wrap{ max-width:1200px; margin:32px auto; padding:0 24px; }
    .timeline-wrap{ position:relative; margin-top:24px; }
    /* Подписи над линией в десктопе — компактный вид */
    @media(min-width:821px){
      .label-top { transform:translate(-50%,-120%); }
    }
    /* Модалка: внутри «подробнее» делаем наклонным (дублируем inline-решение в JS) */
    .detail-more em{ font-style: italic; }
  </style>
</head>
<body>

  <div class="demo-wrap">
    <h1 class="roadmap-title">Юридическая хронология — демо</h1>
    <p class="roadmap-meta">Данные берутся из <code>legal-timeline.json</code>. Клик по точке открывает модалку.</p>

    <!-- Легенда (с учётом твоих цветов и пунктирного образца) -->
    <div class="timeline-legend roadmap-legend" id="legend">
      <div class="legend-item">
        <span class="legend-swatch swatch-light"></span>
        <span>Предпосылки (до иска)</span>
      </div>
      <div class="legend-item">
        <span class="legend-swatch swatch-main"></span>
        <span>Период разбирательства</span>
      </div>
      <div class="legend-item">
        <span class="legend-swatch swatch-block"></span>
        <span>Период блокировки</span>
      </div>
      <div class="legend-item">
        <span class="legend-swatch swatch-future"></span>
        <span>Судебная перспектива вперёд</span>
      </div>
      <!-- ✅ Новое: образец точки события -->
      <div class="legend-item">
        <span class="legend-swatch swatch-point"></span>
        <span>Событие (точка на шкале)</span>
      </div>
    </div>

    <!-- Контейнер линии времени -->
    <div class="timeline-wrap" id="timeline"></div>
  </div>

  <!-- Модалка (единый бэкдроп под эталонные стили) -->
  <div id="modalBackdrop" class="modal-backdrop" aria-hidden="true">
    <div class="modal-dialog" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <button type="button" class="btn" id="modalClose" style="float:right">×</button>
      <h2 id="modalTitle" style="margin-top:0"></h2>
      <div id="modalBody"></div>
    </div>
  </div>

  <script>
  // === Утилиты даты ===
  function ymToDate(str){ // "YYYY-MM" → Date(UTC)
    const [y,m] = str.split('-').map(Number);
    return new Date(Date.UTC(y, (m||1)-1, 1));
  }
  function clamp(n,min,max){ return Math.max(min, Math.min(max, n)); }

  // === Рендер линии (упрощённый: горизонтальная в десктопе, вертикальная в мобайле) ===
  async function initTimeline(){
    const res = await fetch('legal-timeline.json');
    const data = await res.json();

    const wrap = document.getElementById('timeline');
    wrap.innerHTML = ''; // очистка

    // Граница шкалы
    const minDate = ymToDate(data.bounds.start);
    const maxDate = ymToDate(data.bounds.end);

    // Контейнер мегалинии
    const line = document.createElement('div');
    line.className = 'timeline-line';
    line.style.position = 'relative';
    line.style.height = '4px';
    line.style.background = 'var(--indigo-600)'; // Indigo 600
    line.style.borderRadius = '2px';

    // Отступы слева/справа (чтобы крайние точки не прилипали)
    line.style.margin = '80px 24px 40px';

    // Лёгкая предварительная линия (предпосылки)
    const light = document.createElement('div');
    light.className = 'timeline-line light';
    light.style.position = 'absolute';
    light.style.left = '0';
    light.style.right = '0';
    light.style.top = '0';
    light.style.height = '4px';
    light.style.background = 'var(--indigo-200)';

    // Отрезок разбирательства (толстая основная)
    const main = document.createElement('div');
    main.className = 'timeline-line main';
    main.style.position = 'absolute';
    main.style.top = '0';
    main.style.height = '4px';
    main.style.background = 'var(--indigo-600)';

    // Красная (блокировка) — параллельно, ниже
    const block = document.createElement('div');
    block.className = 'timeline-line block';
    block.style.position = 'absolute';
    block.style.top = '10px';
    block.style.height = '6px';
    block.style.background = 'var(--red-500)';

    // Пунктир вперёд (короткий)
    const future = document.createElement('div');
    future.className = 'timeline-line future';
    future.style.position = 'absolute';
    future.style.top = '0';
    future.style.height = '0';
    future.style.borderTop = '4px dashed var(--indigo-600)';

    // Устанавливаем интервалы основных отрезков по датам
    const total = (maxDate - minDate);

    function posX(d){ return ( (d - minDate) / total ) * 100; } // %

    // данные отрезков (из JSON)
    const tStart = ymToDate(data.segments.main.start);
    const tEnd   = ymToDate(data.segments.main.end);
    const blStart= ymToDate(data.segments.block.start);
    const blEnd  = ymToDate(data.segments.block.end);
    const ltStart= ymToDate(data.segments.pre.start);
    const ltEnd  = ymToDate(data.segments.pre.end);
    const fuStart= ymToDate(data.segments.future.start);
    const fuEnd  = ymToDate(data.segments.future.end);

    // Лёгкая линия (предпосылки)
    light.style.left = posX(ltStart) + '%';
    light.style.width = clamp(posX(ltEnd) - posX(ltStart), 0, 100) + '%';

    // Основная линия
    main.style.left = posX(tStart) + '%';
    main.style.width = clamp(posX(tEnd) - posX(tStart), 0, 100) + '%';

    // Блокировка (ниже, параллельно)
    block.style.left = posX(blStart) + '%';
    block.style.width = clamp(posX(blEnd) - posX(blStart), 0, 100) + '%';

    // Пунктирная вперёд
    future.style.left = posX(fuStart) + '%';
    future.style.width = clamp(posX(fuEnd) - posX(fuStart), 0, 100) + '%';

    // Добавляем базовые слои
    line.appendChild(light);
    line.appendChild(main);
    line.appendChild(block);
    line.appendChild(future);

    // Маркер «сейчас»
    const nowX = clamp(posX(ymToDate(data.now)), 0, 100);
    const now = document.createElement('div');
    now.className = 'now-marker';
    now.style.position = 'absolute';
    now.style.top = '-40px'; // чтобы подписи не упирались в верх контейнера
    now.style.bottom = '20px';
    now.style.left = `calc(${nowX}% - 1px)`;
    now.style.width = '2px';
    line.appendChild(now);

    // Точки событий
    data.points.forEach((p,i)=>{
      const ix = clamp(posX(ymToDate(p.pos)), 0, 100);
      const pt = document.createElement('button');
      pt.type = 'button';
      pt.className = 'timeline-point';
      // белая точка
      pt.style.position = 'absolute';
      pt.style.left = ix + '%';
      pt.style.top = '0';
      pt.style.transform = 'translate(-50%,-50%)';
      pt.style.width = '14px';
      pt.style.height = '14px';
      pt.style.borderRadius = '50%';
      pt.style.background = '#fff';
      pt.style.border = '2px solid #fff';
      pt.style.cursor = 'pointer';
      pt.setAttribute('aria-label', p.label);

      // подпись
      const lbl = document.createElement('div');
      lbl.className = 'timeline-label label-top';
      lbl.style.position = 'absolute';
      lbl.style.left = ix + '%';
      lbl.style.top = '0';
      lbl.style.transform = 'translate(-50%,-130%)';
      lbl.style.whiteSpace = 'nowrap';
      lbl.style.color = 'rgba(255,255,255,0.9)';
      lbl.style.fontSize = '.85rem';
      lbl.textContent = p.label;

      // клик — открыть модалку
      pt.addEventListener('click', () => openModalForPoint(p));

      line.appendChild(pt);
      line.appendChild(lbl);
    });

    wrap.appendChild(line);

    // Закрытие модалки
    document.getElementById('modalClose').onclick = closeModal;
    document.getElementById('modalBackdrop').addEventListener('click', (e)=>{
      if(e.target.id === 'modalBackdrop') closeModal();
    });

    // Делегирование на кнопку «Подробнее» (работает и для одиночных, и для комбинированных)
    document.getElementById('modalBackdrop').addEventListener('click', (e)=>{
      const btn = e.target.closest('.js-more-toggle');
      if(!btn) return;
      const targetSel = btn.getAttribute('data-target');
      const moreEl = targetSel ? document.querySelector(targetSel) : btn.parentElement.querySelector('.js-more');
      if(!moreEl) return;
      const hidden = moreEl.hasAttribute('hidden');
      if(hidden){ moreEl.removeAttribute('hidden'); btn.textContent = 'Свернуть'; }
      else { moreEl.setAttribute('hidden',''); btn.textContent = 'Подробнее'; }
    });
  }

  // === Модалка: рендер ===
  function openModalForPoint(p){
    const bd = document.getElementById('modalBackdrop');
    const ttl = document.getElementById('modalTitle');
    const body = document.getElementById('modalBody');

    ttl.textContent = p.label;
    body.innerHTML = '';

    if(Array.isArray(p.items) && p.items.length){
      // Комбинированная точка: список событий
      p.items.forEach((it, idx)=>{
        const block = document.createElement('div');
        block.style.marginBottom = '12px';

        const h = document.createElement('h3');
        h.textContent = it.title || `Событие ${idx+1}`;
        h.style.margin = '0 0 6px';
        h.style.fontSize = '1rem';

        const shortP = document.createElement('p');
        shortP.textContent = it.summary || '';
        shortP.style.margin = '0 0 6px';

        const more = document.createElement('div');
        more.className = 'detail-more js-more';
        more.setAttribute('hidden','');
        more.innerHTML = it.details ? `<em>${escapeHTML(it.details)}</em>` : '';

        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'btn js-more-toggle';
        btn.textContent = 'Подробнее';
        btn.setAttribute('data-target', ''); // делегирование найдёт ближайший .js-more

        block.appendChild(h);
        block.appendChild(shortP);
        block.appendChild(btn);
        block.appendChild(more);
        body.appendChild(block);
      });
    } else {
      // Одиночная точка
      const h = document.createElement('h3');
      h.textContent = p.title || 'Событие';
      h.style.margin = '0 0 6px';
      h.style.fontSize = '1rem';

      const shortP = document.createElement('p');
      shortP.textContent = p.summary || '';
      shortP.style.margin = '0 0 6px';

      const more = document.createElement('div');
      more.className = 'detail-more js-more';
      more.setAttribute('hidden','');
      more.innerHTML = p.details ? `<em>${escapeHTML(p.details)}</em>` : '';

      const btn = document.createElement('button');
      btn.type = 'button';
      btn.className = 'btn js-more-toggle';
      btn.textContent = 'Подробнее';

      body.appendChild(h);
      body.appendChild(shortP);
      body.appendChild(btn);
      body.appendChild(more);
    }

    bd.classList.add('show');
    document.body.classList.add('modal-open');
    bd.setAttribute('aria-hidden','false');
  }

  function closeModal(){
    const bd = document.getElementById('modalBackdrop');
    bd.classList.remove('show');
    document.body.classList.remove('modal-open');
    bd.setAttribute('aria-hidden','true');
  }

  function escapeHTML(s){
    return String(s)
      .replaceAll('&','&amp;')
      .replaceAll('<','&lt;')
      .replaceAll('>','&gt;')
      .replaceAll('"','&quot;')
      .replaceAll("'",'&#039;');
  }

  // init
  initTimeline();
  </script>
</body>
</html>
<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Legal Timeline Demo</title>

  <!-- Подключаем эталонные стили сайта -->
  <link rel="stylesheet" href="styles.css"/>

  <!-- Минимальные локальные стили только для демо (не конфликтуют с сайтом) -->
  <style>
    /* Локальный свотч-точка в легенде (как белая точка на шкале) */
    .legend-swatch.swatch-point{
      width:14px; height:14px; border-radius:9999px;
      background:#fff; border:2px solid #fff;
      display:inline-block; vertical-align:middle;
      box-shadow:0 0 0 1px rgba(0,0,0,0.15);
    }
    /* Контейнер демо, отступы по бокам, чтобы крайние точки не прилипали */
    .demo-wrap{ max-width:1200px; margin:32px auto; padding:0 24px; }
    .timeline-wrap{ position:relative; margin-top:24px; }
    /* Подписи над линией в десктопе — компактный вид */
    @media(min-width:821px){
      .label-top { transform:translate(-50%,-120%); }
    }
    /* Модалка: внутри «подробнее» делаем наклонным (дублируем inline-решение в JS) */
    .detail-more em{ font-style: italic; }
  </style>
</head>
<body>

  <div class="demo-wrap">
    <h1 class="roadmap-title">Юридическая хронология — демо</h1>
    <p class="roadmap-meta">Данные берутся из <code>legal-timeline.json</code>. Клик по точке открывает модалку.</p>

    <!-- Легенда (с учётом твоих цветов и пунктирного образца) -->
    <div class="timeline-legend roadmap-legend" id="legend">
      <div class="legend-item">
        <span class="legend-swatch swatch-light"></span>
        <span>Предпосылки (до иска)</span>
      </div>
      <div class="legend-item">
        <span class="legend-swatch swatch-main"></span>
        <span>Период разбирательства</span>
      </div>
      <div class="legend-item">
        <span class="legend-swatch swatch-block"></span>
        <span>Период блокировки</span>
      </div>
      <div class="legend-item">
        <span class="legend-swatch swatch-future"></span>
        <span>Судебная перспектива вперёд</span>
      </div>
      <!-- ✅ Новое: образец точки события -->
      <div class="legend-item">
        <span class="legend-swatch swatch-point"></span>
        <span>Событие (точка на шкале)</span>
      </div>
    </div>

    <!-- Контейнер линии времени -->
    <div class="timeline-wrap" id="timeline"></div>
  </div>

  <!-- Модалка (единый бэкдроп под эталонные стили) -->
  <div id="modalBackdrop" class="modal-backdrop" aria-hidden="true">
    <div class="modal-dialog" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <button type="button" class="btn" id="modalClose" style="float:right">×</button>
      <h2 id="modalTitle" style="margin-top:0"></h2>
      <div id="modalBody"></div>
    </div>
  </div>

  <script>
  // === Утилиты даты ===
  function ymToDate(str){ // "YYYY-MM" → Date(UTC)
    const [y,m] = str.split('-').map(Number);
    return new Date(Date.UTC(y, (m||1)-1, 1));
  }
  function clamp(n,min,max){ return Math.max(min, Math.min(max, n)); }

  // === Рендер линии (упрощённый: горизонтальная в десктопе, вертикальная в мобайле) ===
  async function initTimeline(){
    const res = await fetch('legal-timeline.json');
    const data = await res.json();

    const wrap = document.getElementById('timeline');
    wrap.innerHTML = ''; // очистка

    // Граница шкалы
    const minDate = ymToDate(data.bounds.start);
    const maxDate = ymToDate(data.bounds.end);

    // Контейнер мегалинии
    const line = document.createElement('div');
    line.className = 'timeline-line';
    line.style.position = 'relative';
    line.style.height = '4px';
    line.style.background = 'var(--indigo-600)'; // Indigo 600
    line.style.borderRadius = '2px';

    // Отступы слева/справа (чтобы крайние точки не прилипали)
    line.style.margin = '80px 24px 40px';

    // Лёгкая предварительная линия (предпосылки)
    const light = document.createElement('div');
    light.className = 'timeline-line light';
    light.style.position = 'absolute';
    light.style.left = '0';
    light.style.right = '0';
    light.style.top = '0';
    light.style.height = '4px';
    light.style.background = 'var(--indigo-200)';

    // Отрезок разбирательства (толстая основная)
    const main = document.createElement('div');
    main.className = 'timeline-line main';
    main.style.position = 'absolute';
    main.style.top = '0';
    main.style.height = '4px';
    main.style.background = 'var(--indigo-600)';

    // Красная (блокировка) — параллельно, ниже
    const block = document.createElement('div');
    block.className = 'timeline-line block';
    block.style.position = 'absolute';
    block.style.top = '10px';
    block.style.height = '6px';
    block.style.background = 'var(--red-500)';

    // Пунктир вперёд (короткий)
    const future = document.createElement('div');
    future.className = 'timeline-line future';
    future.style.position = 'absolute';
    future.style.top = '0';
    future.style.height = '0';
    future.style.borderTop = '4px dashed var(--indigo-600)';

    // Устанавливаем интервалы основных отрезков по датам
    const total = (maxDate - minDate);

    function posX(d){ return ( (d - minDate) / total ) * 100; } // %

    // данные отрезков (из JSON)
    const tStart = ymToDate(data.segments.main.start);
    const tEnd   = ymToDate(data.segments.main.end);
    const blStart= ymToDate(data.segments.block.start);
    const blEnd  = ymToDate(data.segments.block.end);
    const ltStart= ymToDate(data.segments.pre.start);
    const ltEnd  = ymToDate(data.segments.pre.end);
    const fuStart= ymToDate(data.segments.future.start);
    const fuEnd  = ymToDate(data.segments.future.end);

    // Лёгкая линия (предпосылки)
    light.style.left = posX(ltStart) + '%';
    light.style.width = clamp(posX(ltEnd) - posX(ltStart), 0, 100) + '%';

    // Основная линия
    main.style.left = posX(tStart) + '%';
    main.style.width = clamp(posX(tEnd) - posX(tStart), 0, 100) + '%';

    // Блокировка (ниже, параллельно)
    block.style.left = posX(blStart) + '%';
    block.style.width = clamp(posX(blEnd) - posX(blStart), 0, 100) + '%';

    // Пунктирная вперёд
    future.style.left = posX(fuStart) + '%';
    future.style.width = clamp(posX(fuEnd) - posX(fuStart), 0, 100) + '%';

    // Добавляем базовые слои
    line.appendChild(light);
    line.appendChild(main);
    line.appendChild(block);
    line.appendChild(future);

    // Маркер «сейчас»
    const nowX = clamp(posX(ymToDate(data.now)), 0, 100);
    const now = document.createElement('div');
    now.className = 'now-marker';
    now.style.position = 'absolute';
    now.style.top = '-40px'; // чтобы подписи не упирались в верх контейнера
    now.style.bottom = '20px';
    now.style.left = `calc(${nowX}% - 1px)`;
    now.style.width = '2px';
    line.appendChild(now);

    // Точки событий
    data.points.forEach((p,i)=>{
      const ix = clamp(posX(ymToDate(p.pos)), 0, 100);
      const pt = document.createElement('button');
      pt.type = 'button';
      pt.className = 'timeline-point';
      // белая точка
      pt.style.position = 'absolute';
      pt.style.left = ix + '%';
      pt.style.top = '0';
      pt.style.transform = 'translate(-50%,-50%)';
      pt.style.width = '14px';
      pt.style.height = '14px';
      pt.style.borderRadius = '50%';
      pt.style.background = '#fff';
      pt.style.border = '2px solid #fff';
      pt.style.cursor = 'pointer';
      pt.setAttribute('aria-label', p.label);

      // подпись
      const lbl = document.createElement('div');
      lbl.className = 'timeline-label label-top';
      lbl.style.position = 'absolute';
      lbl.style.left = ix + '%';
      lbl.style.top = '0';
      lbl.style.transform = 'translate(-50%,-130%)';
      lbl.style.whiteSpace = 'nowrap';
      lbl.style.color = 'rgba(255,255,255,0.9)';
      lbl.style.fontSize = '.85rem';
      lbl.textContent = p.label;

      // клик — открыть модалку
      pt.addEventListener('click', () => openModalForPoint(p));

      line.appendChild(pt);
      line.appendChild(lbl);
    });

    wrap.appendChild(line);

    // Закрытие модалки
    document.getElementById('modalClose').onclick = closeModal;
    document.getElementById('modalBackdrop').addEventListener('click', (e)=>{
      if(e.target.id === 'modalBackdrop') closeModal();
    });

    // Делегирование на кнопку «Подробнее» (работает и для одиночных, и для комбинированных)
    document.getElementById('modalBackdrop').addEventListener('click', (e)=>{
      const btn = e.target.closest('.js-more-toggle');
      if(!btn) return;
      const targetSel = btn.getAttribute('data-target');
      const moreEl = targetSel ? document.querySelector(targetSel) : btn.parentElement.querySelector('.js-more');
      if(!moreEl) return;
      const hidden = moreEl.hasAttribute('hidden');
      if(hidden){ moreEl.removeAttribute('hidden'); btn.textContent = 'Свернуть'; }
      else { moreEl.setAttribute('hidden',''); btn.textContent = 'Подробнее'; }
    });
  }

  // === Модалка: рендер ===
  function openModalForPoint(p){
    const bd = document.getElementById('modalBackdrop');
    const ttl = document.getElementById('modalTitle');
    const body = document.getElementById('modalBody');

    ttl.textContent = p.label;
    body.innerHTML = '';

    if(Array.isArray(p.items) && p.items.length){
      // Комбинированная точка: список событий
      p.items.forEach((it, idx)=>{
        const block = document.createElement('div');
        block.style.marginBottom = '12px';

        const h = document.createElement('h3');
        h.textContent = it.title || `Событие ${idx+1}`;
        h.style.margin = '0 0 6px';
        h.style.fontSize = '1rem';

        const shortP = document.createElement('p');
        shortP.textContent = it.summary || '';
        shortP.style.margin = '0 0 6px';

        const more = document.createElement('div');
        more.className = 'detail-more js-more';
        more.setAttribute('hidden','');
        more.innerHTML = it.details ? `<em>${escapeHTML(it.details)}</em>` : '';

        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'btn js-more-toggle';
        btn.textContent = 'Подробнее';
        btn.setAttribute('data-target', ''); // делегирование найдёт ближайший .js-more

        block.appendChild(h);
        block.appendChild(shortP);
        block.appendChild(btn);
        block.appendChild(more);
        body.appendChild(block);
      });
    } else {
      // Одиночная точка
      const h = document.createElement('h3');
      h.textContent = p.title || 'Событие';
      h.style.margin = '0 0 6px';
      h.style.fontSize = '1rem';

      const shortP = document.createElement('p');
      shortP.textContent = p.summary || '';
      shortP.style.margin = '0 0 6px';

      const more = document.createElement('div');
      more.className = 'detail-more js-more';
      more.setAttribute('hidden','');
      more.innerHTML = p.details ? `<em>${escapeHTML(p.details)}</em>` : '';

      const btn = document.createElement('button');
      btn.type = 'button';
      btn.className = 'btn js-more-toggle';
      btn.textContent = 'Подробнее';

      body.appendChild(h);
      body.appendChild(shortP);
      body.appendChild(btn);
      body.appendChild(more);
    }

    bd.classList.add('show');
    document.body.classList.add('modal-open');
    bd.setAttribute('aria-hidden','false');
  }

  function closeModal(){
    const bd = document.getElementById('modalBackdrop');
    bd.classList.remove('show');
    document.body.classList.remove('modal-open');
    bd.setAttribute('aria-hidden','true');
  }

  function escapeHTML(s){
    return String(s)
      .replaceAll('&','&amp;')
      .replaceAll('<','&lt;')
      .replaceAll('>','&gt;')
      .replaceAll('"','&quot;')
      .replaceAll("'",'&#039;');
  }

  // init
  initTimeline();
  </script>
</body>
</html>
